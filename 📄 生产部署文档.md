# 1️⃣ 服务器准备
    系统要求
    Linux 系统（推荐 Ubuntu 22.04 或 CentOS 8）
    CPU ≥ 2 核，内存 ≥ 4GB
    磁盘 ≥ 20GB（SSD 优先）
    软件要求:
    | 软件             | 版本    | 说明             |
    | -------------- | ----- | -------------- |
    | Docker CE      | ≥24.x | 容器运行环境         |
    | Docker Compose | ≥2.20 | 容器编排           |
    | Git            | 最新    | 拉取代码           |
    | Nginx          | 1.18+ | 前端静态文件服务，可选    |
    | PM2            | 最新    | Node 后端进程管理，可选 |
# 2️⃣ 环境配置
## 克隆项目：
    git clone https://github.com/jiandanhai/srs_anki_fullstack_commercial.git
    cd srs_anki_fullstack_commercial
## 配置 .env 文件：
    cp .env.example .env
    修改端口（BACKEND_PORT、FRONTEND_PORT）
    修改数据库账号密码（DB_USER、DB_PASS、DB_NAME）
    设置环境：NODE_ENV=production
## 确保防火墙允许端口访问：
    # 以 Ubuntu 为例
    sudo ufw allow 3000/tcp  # 前端
    sudo ufw allow 4000/tcp  # 后端
    sudo ufw allow 5432/tcp  # PostgreSQL
    sudo ufw reload
# 3️⃣ Docker 镜像构建
    export NODE_ENV=production
    # 构建后端镜像
    docker-compose build backend
    # 构建前端镜像
    docker-compose build frontend
    # 构建数据库镜像（可选）
    docker-compose build db
# 4️⃣ 启动服务
    docker-compose up -d
    后端：Node dist/main.js
    前端：Nginx 静态文件
    数据库：PostgreSQL
    持久化卷：pgdata
# 访问地址
    | 服务     | URL/端口                                             |
    | ------ | -------------------------------------------------- |
    | 前端     | [http://your-domain:3000](http://your-domain:3000) |
    | 后端 API | [http://your-domain:4000](http://your-domain:4000) |
    | 数据库    | localhost:5432                                     |
# 5️⃣ 可选优化
    反向代理 & HTTPS
        使用 Nginx 或 Traefik 配置域名和 TLS
        可启用 gzip 压缩、缓存静态文件
    Node 后端管理
        使用 PM2 监控 Node 进程
        日志输出到文件，便于排查问题
    数据库
        数据卷持久化 (pgdata)
        可换成云数据库（RDS / 云 PostgreSQL）
# 6️⃣ 部署流程总结
    准备服务器，安装 Docker + Docker Compose
    拉取项目，配置 .env
    构建镜像（backend/frontend/db）
    启动容器 docker-compose up -d
    可选：配置域名、HTTPS、日志管理
# 📄 生产部署一键脚本 deploy.sh
#!/bin/bash

# ============================
# SRS Anki Fullstack 生产部署脚本
# ============================

# 设置环境
export NODE_ENV=production

# 项目路径
PROJECT_DIR=$(pwd)

echo "==============================="
echo "🔹 SRS Anki Fullstack 部署"
echo "项目路径: $PROJECT_DIR"
echo "环境: $NODE_ENV"
echo "==============================="

# 1. 拉取最新代码
echo "⏳ 拉取最新代码..."
git pull origin main || echo "Git 拉取失败，请确认已配置远程仓库"

# 2. 构建 Docker 镜像
echo "⏳ 构建 Docker 镜像..."
docker-compose build

# 3. 停止并删除旧容器
echo "⏳ 停止旧容器..."
docker-compose down

# 4. 启动容器
echo "⏳ 启动容器..."
docker-compose up -d

# 5. 输出状态
echo "==============================="
echo "✅ 部署完成!"
echo "前端访问: http://localhost:3000"
echo "后端访问: http://localhost:4000"
echo "数据库端口: 5432"
echo "==============================="

# 6. 日志提示
echo "📌 查看前端日志: docker logs -f srs_frontend"
echo "📌 查看后端日志: docker logs -f srs_backend"


## ✅ 使用方法
    上传脚本到项目根目录：
        chmod +x deploy.sh
    直接运行：
        ./deploy.sh
    会自动拉取代码、构建镜像、启动容器
    完整支持生产模式 (NODE_ENV=production)
# SRS Anki Fullstack 商业级生产部署拓扑图
                     ┌──────────────────────────┐
                     │        用户浏览器        │
                     │  (访问域名或公网 IP)     │
                     └───────────┬─────────────┘
                                 │
                                 ▼
                    ┌──────────────────────────┐
                    │        Nginx 前端        │
                    │  - 服务静态文件 (dist/) │
                    │  - HTTPS / TLS 支持      │
                    │  - gzip 压缩、缓存      │
                    └───────────┬─────────────┘
                                │
          ┌─────────────────────┴─────────────────────┐
          │                                           │
          ▼                                           ▼
┌──────────────────────────┐                 ┌──────────────────────────┐
│       Node 后端容器      │                 │       PostgreSQL 容器    │
│  - NestJS + dist/main.js │ <────────────>  │  - 数据持久化 pgdata 卷 │
│  - API 接口服务          │                 │  - 生产环境账号/密码     │
│  - 日志管理 (PM2 可选)  │                 │                          │
└──────────────────────────┘                 └──────────────────────────┘

## 🔹 说明
    用户访问
        用户通过浏览器访问前端域名或 IP
        Nginx 负责静态文件服务，并处理 HTTPS / TLS
    前端与后端通信
        React 前端通过 API 调用后端 Node 容器
        所有请求统一通过 Nginx 或直接访问后端端口
    后端与数据库
        Node 后端通过 TypeORM 与 PostgreSQL 交互
        数据持久化在 Docker 卷 pgdata，保证重启或迁移数据安全
    生产优化
        前端：Nginx 静态文件 + 缓存 + gzip + HTTPS
        后端：Node dist/main.js + PM2（可选）
        数据库：持久化卷 + 安全账号管理
    ✅ 优势：
    完整商业级部署架构
    前后端解耦，支持独立伸缩
    支持 HTTPS、缓存、日志管理
    Docker 容器化，便于 CI/CD 和快速上线